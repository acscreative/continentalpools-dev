"use strict";(function(){jQuery(document).ready(function(d){var _,n,i,c,o,p,t,r,e,l,k,f;return f=null!=(e=window.wc_local_pickup_plus_frontend)?e:{},t=function(e){return!!e&&(e.is(".processing")||e.parents(".processing").length)},_=function(e){if(e&&!t(e))return e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},k=function(e){if(e)return e.removeClass("processing").unblock()},i=function(){var a,c,o,e;return e=d("#wc-local-pickup-plus-toggle-default-handling").find("a.toggle-default-handling"),a="3.5.3"===f.select2_version?d("div.woocommerce > form"):d("form.woocommerce-cart-form"),c=d("div.cart_totals"),o=d("#order_review"),e.on("click",function(e){var t,i;return e.preventDefault(),_(a),_(c),_(o),t=d(this).hasClass("pickup")?"pickup":"ship",i={action:"wc_local_pickup_plus_set_default_handling",security:f.set_default_handling_nonce,handling:t},d.post(f.ajax_url,i,function(e){return e.success?f.is_checkout?(r()&&n(),d("form.woocommerce-checkout").trigger("update_checkout")):d(document).trigger("wc_update_cart"):console.log(e),k(a),k(c),k(o)})})},r=function(){var e,t,i,a;return a=d("#shipping_state").val(),i=d("input#shipping_postcode").val(),t=d("#shipping_city").val(),e=d("input#shipping_address_1").val(),""===a&&""===i&&""===t&&""===e},n=function(){return d("#shipping_state").val(d("#billing_state").val()),d("input#shipping_postcode").val(d("input#billing_postcode").val()),d("#shipping_city").val(d("#billing_city").val()),d("input#shipping_address_1").val(d("input#billing_address_1").val())},c=function(){var e;return d("a.enable-local-pickup, a.disable-local-pickup").on("click",function(e){var t,i,a,c,o,n,p,r,l,u;return e.preventDefault(),a=d(this).parent().parent(),t="3.5.3"===f.select2_version?d("div.woocommerce > form"):d("form.woocommerce-cart-form"),i=d("#order_review"),d(this).hasClass("enable-local-pickup")?(r="pickup",a.find("a.enable-local-pickup").parent().hide(),a.find("a.disable-local-pickup").parent().show(),a.find("> div").show()):(r="ship",a.find("a.enable-local-pickup").parent().show(),a.find("a.disable-local-pickup").parent().hide(),a.find("> div").hide()),_(t),_(i),c=a.find(".pickup-location-lookup-area"),(l=(u=(n=a.find(".pickup-location-lookup")).attr("data-single-pickup-location"))&&0<parseInt(u,10)?u:n.val())||"per-order"!==f.pickup_selection_mode||(l=(o=d('[name="shipping_method_pickup_location_id[0]"]')).length?o.val():l),p={action:"wc_local_pickup_plus_set_cart_item_handling",security:f.set_cart_item_handling_nonce,cart_item_key:a.data("pickup-object-id"),pickup_data:{handling:r,lookup_area:c.val(),pickup_location_id:l}},d.post(f.ajax_url,p,function(e){return"per-order"===f.pickup_selection_mode&&d(".pickup-location-lookup").trigger("change"),k(t),k(i),e.success?f.is_cart?d(document).trigger("wc_update_cart"):f.is_checkout?d("form.woocommerce-checkout").trigger("update_checkout"):void 0:console.log(e)})}),d(".pickup-location-change-lookup-area").on("click",function(e){return e.preventDefault(),d(this).closest("div.pickup-location-lookup-area-field").find("> div").toggle()}),(e=d("select.pickup-location-lookup-area")).select2(),e.on("change",function(e){var t,i,a,c,o,n,p,r,l,u,s;if(p=d(this).closest(".pickup-location-lookup-area-field").data("pickup-object-id"),!0!==d("#pickup-location-field-for-"+p).find("a.enable-local-pickup").is(":visible"))return a=d("#pickup-location-lookup-area-field-for-"+p).find("em.pickup-location-current-lookup-area-label"),r=d(this).select2("data"),t="3.5.3"===f.select2_version?d("div.woocommerce > form"):d("form.woocommerce-cart-form"),i=d("#order_review"),r&&("3.5.3"===f.select2_version?a.text(r.text):r[0]&&r[0].text&&a.text(r[0].text)),!1===f.select2_version&&(_(t),_(i)),o=d("#pickup-location-field-for-"+p),u=(c="3.5.3"===f.select2_version?o.find(".pickup-location-lookup-data"):o.find(".pickup-location-lookup")).data("pickup-object-type"),l=(s=c.attr("data-single-pickup-location"))&&0<parseInt(s,10)?s:c.val(),"cart-item"===u?n={action:"wc_local_pickup_plus_set_cart_item_handling",security:f.set_cart_item_handling_nonce,cart_item_key:p,pickup_data:{handling:"pickup",lookup_area:d(this).val(),pickup_location_id:l}}:"package"===u&&(n={action:"wc_local_pickup_plus_set_package_handling",security:f.set_package_handling_nonce,package_id:p,lookup_area:d(this).val(),pickup_location_id:l}),d.post(f.ajax_url,n,function(e){return k(t),k(i),e.success?f.is_cart?d(document).trigger("wc_update_cart"):f.is_checkout?d("form.woocommerce-checkout").trigger("update_checkout"):void 0:console.log(e)})})},o=function(){var c,o;return o=function(e,t,i){var a,c,o,n;return e=e?e.toLowerCase():"",t=t?t.toLowerCase():"",o=!1,e&&(t&&-1<t.indexOf(e)&&(o=!0),!o&&i&&("3.5.3"===f.select2_version?(n=String(d(i.context).data("postcode")),c=d(i.context).data("city"),a=d(i.context).data("address")):(n=String(d(i.element).data("postcode")),c=d(i.element).data("city"),a=d(i.element).data("address")),n&&-1<n.toLowerCase().indexOf(e)&&(o=!0),!o&&c&&-1<c.toLowerCase().indexOf(e)&&(o=!0),!o&&a&&-1<a.toLowerCase().indexOf(e)&&(o=!0))),o},"3.5.3"===f.select2_version?f.use_enhanced_search?(c=d("input.pickup-location-lookup")).select2({initSelection:function(e,t){var i,a;return""!==(a=e.val())?(i={action:"wc_local_pickup_plus_get_pickup_location_name",security:f.get_pickup_location_name_nonce,id:a},d.post(f.ajax_url,i,function(e){if(e&&e.success&&e.data)return t({id:a,text:e.data})})):t({text:c.data("placeholder")})},minimumInputLength:2,formatInputTooShort:function(){return f.i18n.search_type_minimum_characters},ajax:{url:f.ajax_url,cache:!1,dataType:"json",quietMillis:250,data:function(e,t){var i,a,c;return c=d(this).data("product-id"),a=d(this).data("pickup-object-id"),{term:e,area:(i=d(this).parent().find("#pickup-location-lookup-area-for-"+a))?i.find("option:selected").val():"",cart_item_id:a,product_id:c,page:t,security:f.pickup_locations_lookup_nonce,action:"wc_local_pickup_plus_pickup_locations_lookup"}},results:function(e){var t;return t={text:"text",results:[]},e.success&&e.success&&e.data?{text:"text",results:e.data}:t}}}):(c=d("select.pickup-location-lookup")).select2({matcher:function(e,t,i){var a;return a=!0,e&&(a=o(e,t,i)),a}}):(c=d("select.pickup-location-lookup"),f.use_enhanced_search?c.select2({initSelection:function(e,t){var i,a;return""!==(a=e.val())?(i={action:"wc_local_pickup_plus_get_pickup_location_name",security:f.get_pickup_location_name_nonce,id:a},d.post(f.ajax_url,i,function(e){if(e&&e.success&&e.data)return t({id:a,text:e.data})})):t({text:c.data("placeholder")})},minimumInputLength:2,formatInputTooShort:function(){return f.i18n.search_type_minimum_characters},ajax:{url:f.ajax_url,cache:!1,dataType:"json",delay:250,data:function(e){var t,i,a;return a=d(this).data("product-id"),i=d(this).data("pickup-object-id"),t=d(this).parent().find("#pickup-location-lookup-area-for-"+i),{term:e.term,area:t?t.find("option:selected").val():"",cart_item_id:i,product_id:a,page:e.page,security:f.pickup_locations_lookup_nonce,action:"wc_local_pickup_plus_pickup_locations_lookup"}},processResults:function(e,t){return{results:e&&e.success&&e.data?e.data:[]}}}}):d.fn.select2.amd.require(["select2/compat/matcher"],function(e){return c.select2({matcher:e(o)})})),c.on("change",function(e){var t,i,a,c,o,n,p;if(t="3.5.3"===f.select2_version?d("div.woocommerce > form"):d("form.woocommerce-cart-form, div.cart_totals"),i=d("#order_review"),_(t),_(i),n=d(this).data("pickup-object-type"),p=d(this).data("pickup-object-id"),c=d(this).val(),o=d("#pickup-location-lookup-area-for-"+p).val(),"cart-item"===n?a={action:"wc_local_pickup_plus_set_cart_item_handling",security:f.set_cart_item_handling_nonce,cart_item_key:p,pickup_data:{handling:"pickup",lookup_area:o,pickup_location_id:c}}:"package"===n&&(a={action:"wc_local_pickup_plus_set_package_handling",security:f.set_package_handling_nonce,package_id:p,lookup_area:o,pickup_location_id:c}),a)return d.post(f.ajax_url,a,function(e){return k(t),k(i),e.success?f.is_cart?d(document).trigger("wc_update_cart"):f.is_checkout?d("form.woocommerce-checkout").trigger("update_checkout"):void 0:console.log(e)})})},l=function(){var e;return(e=parseInt(d("#wc-local-pickup-plus-packages-to-ship").val(),10))<parseInt(d("#wc-local-pickup-plus-packages-to-pickup").val(),10)&&0===e?(d("#shiptobilling, #ship-to-different-address").hide(),d("#shiptobilling, #ship-to-different-address").parent().find("h3").hide(),d(".shipping_address").hide()):(d("#shiptobilling, #ship-to-different-address").show(),d("#shiptobilling, #ship-to-different-address").parent().find("h3").show(),0<d("#shiptobilling input").length&&!d("#shiptobilling input").is(":checked")||d("#ship-to-different-address input").is(":checked")?d(".shipping_address").show():void 0)},(p=function(){return d(".wc-lpp-help-tip").each(function(){return d(this).tipTip({content:d(this).data("tip"),keepAlive:!0,edgeOffset:2})})})(),i(),c(),o(),"undefined"!=typeof wc_checkout_params&&l(),d(document.body).on("updated_checkout",function(){var e,a,t;return a=function(c,e){var o,t,n,p,i,a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return t=(o=c.find("input.pickup-location-appointment-date")).val(),n=o.data("location-id"),p=o.data("package-id"),i=e.unavailable_dates?d.map(e.unavailable_dates,function(e){return e}):[],a&&(o.attr("value",""),o.trigger("change"),o.removeClass("hasDatepicker"),o.datepicker("destroy")),o.datepicker({minDate:new Date(e.calendar_start),maxDate:new Date(e.calendar_end),dateFormat:"yy-mm-dd",defaultDate:""!==t?t:null,firstDay:f.start_of_week,monthNames:f.month_names,dayNamesMin:f.day_initials,prevText:"",nextText:"",beforeShow:function(e,t){return d(t.dpDiv).addClass("pickup-location-appointment-datepicker")},beforeShowDay:function(e){var t;return t=d.datepicker.formatDate("yy-mm-dd",e),[-1===i.indexOf(t)]},onSelect:function(){var e,t,i,a;if(e=d("#wc-local-pickup-plus-datepicker-"+p),n=e.data("location-id"),(a=e.val())&&(i=new Date(a)))return o.attr("value",a),t={action:"wc_local_pickup_plus_set_package_handling",security:f.set_package_handling_nonce,pickup_date:a,package_id:p,pickup_location_id:n},d.post(f.ajax_url,t,function(e){return e.success||console.log(e),t={action:"wc_local_pickup_plus_get_pickup_location_opening_hours_list",security:f.get_pickup_location_opening_hours_list_nonce,location:n,date:a,day:i.getDay()},d.post(f.ajax_url,t,function(e){var t;if((t=c.find(".pickup-location-schedule")).empty(),e&&e.success)return t.append(e.data),d("form.woocommerce-checkout").trigger("update_checkout")})})}})},(e=d(".pickup-location-appointment"))&&e.each(function(){var t,e,i;return e=(t=d(this)).find("input.pickup-location-appointment-date").data("location-id"),i={action:"wc_local_pickup_plus_get_pickup_location_appointment_data",security:f.get_pickup_location_appointment_data_nonce,location:e},d.post(f.ajax_url,i,function(e){if(e.success)return a(t,e.data)})}),p(),i(),c(),o(),l(),t={action:"wc_local_pickup_plus_get_shipping_destination",security:f.get_shipping_destination_nonce},d.post(f.ajax_url,t,function(e){var t,i,a;if(e&&e.success&&(i=d("#customer_details").find(".woocommerce-shipping-fields")))if(a=i.find("#ship-to-different-address"),t=i.find("#ship-to-different-address-checkbox"),"shipping"!==e.data||!f.is_user_logged_in||!i.is(":empty")&&d.trim(i.html()).length){if("billing_only"===e.data&&a&&!t.is(":visible")&&t.is(":checked"))return t.prop("checked",!1)}else;}),d("#order_review").find("> p.woocommerce-shipping-contents").remove()}),d("#order_review").find("> p.woocommerce-shipping-contents").remove(),d(document.body).on("updated_cart_totals",function(){return p(),i(),c(),o()})})}).call(void 0);